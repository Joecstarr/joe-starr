{{ $filepath := "/static/ducks" }}
{{ $files    := readDir $filepath }}
{{ $ext := default "-" (.Get "type" )}}
{{ if (fileExists $filepath)}}

<h1 style="margin:auto;text-align:center;padding-bottom:4vh;">Duck of the day!</h1>
<div id="duck_of_the_day" ></div>

<h1 style="margin:auto;text-align:center;padding-top:10vh;">Ducks on the pond!</h1>
<div id="duck_pond"class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
</div>
<script>
    var pics = [
    {{ $filepath := "/static/ducks" }}
    {{ $files    := readDir $filepath }}
    {{ $ext := default "-" (.Get "type" )}}
    {{ if (fileExists $filepath)}}

    {{ range readDir $filepath }}
    {{ $imgURL := print "./static/ducks/" .Name }}
    {{- if hasSuffix .Name ".jpg" -}}
    {{print "/ducks/" .Name}},
    {{- end -}}
    {{- if hasSuffix .Name ".jpeg" -}}
    {{print "/ducks/" .Name}} ,
    {{- end -}}
    {{- if hasSuffix .Name ".JPEG" -}}
    {{print "/ducks/" .Name}} ,
    {{- end -}}
    {{- if hasSuffix .Name ".png" -}}
    {{print "/ducks/" .Name}} ,
    {{- end -}}
    {{ end }}

    {{end}}]

    function shuffleArray(array) {
        const copiedArray = [...array];
        for (let i = copiedArray.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [copiedArray[i], copiedArray[j]] = [copiedArray[j], copiedArray[i]];
        }
        return copiedArray
    }

    async function sha256(message) {
        // encode as UTF-8
        const msgBuffer = new TextEncoder().encode(message);

        // hash the message
        const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);

        // convert ArrayBuffer to Array
        const hashArray = Array.from(new Uint8Array(hashBuffer));

        // convert bytes to hex string
        const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        return parseInt(hashHex, 16);
    }

    const today = new Date().toISOString().slice(0, 10);;
    var id_container = document.getElementById("duck_count");
    id_container.innerHTML = pics.length;

    sha256(today).then(function (result) {
        const duck_of_the_day = document.getElementById('duck_of_the_day')
        var pond_container = document.getElementById("duck_pond");
        
        var dotd = document.createElement("img");
        dotd.src = pics[result % pics.length];
        duck_of_the_day.appendChild(dotd);

        shuffleArray(pics).forEach(function (element) {
            var duck = document.createElement("img");
            duck.src = element;
            pond_container.appendChild(duck);
        })
        duck.appendChild(element)
    })


</script>
<!-- end randomimage -->

{{end}}